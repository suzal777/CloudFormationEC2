name: Test bump tag locally
on:
  workflow_dispatch:
    inputs:
      bump:
        required: false
        default: patch

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Mock get_tag
        id: get_tag
        run: echo "result=v1.2.3" >> $GITHUB_OUTPUT

      - name: Bump version and create tag
        env:
          LATEST_TAG: ${{ steps.get_tag.outputs.result }}
          BUMP_TYPE: ${{ github.event.inputs.bump || 'patch' }}
        run: |
          latest_tag=${LATEST_TAG}
          echo "Latest tag: $latest_tag"

          version=${latest_tag#v}
          IFS='.' read -r major minor patch <<< "$version"

          bump_type="${BUMP_TYPE}"
          if [ "$bump_type" = "major" ]; then
            major=$((major + 1))
            minor=0
            patch=0
          elif [ "$bump_type" = "minor" ]; then
            minor=$((minor + 1))
            patch=0
          else
            patch=$((patch + 1))
          fi

          new_tag="v$major.$minor.$patch"
          echo "New tag: $new_tag"
